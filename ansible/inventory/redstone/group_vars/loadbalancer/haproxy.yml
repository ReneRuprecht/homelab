---
# ssl configs
server_url: !vault |
  $ANSIBLE_VAULT;1.1;AES256
  31663461376561386539636561636666633430663363666133343565363666623730646232356436
  6539383864353430346533343332656632323035623037630a353363313330363931323332636637
  34353430333339313665633038646539353066316632336534613066303733646133306539393861
  3437336564323936390a316666353735623335303531346238613162303366613561386262323066
  66393334386265396165643132613336353466636430306533366337303439393064

servers_consul: !vault |
  $ANSIBLE_VAULT;1.1;AES256
  66356332613339656232613635313836313631353631343565396136633063663531633533393432
  3936333439396365653161613433366463396561356664620a613834663965633235363136656333
  34346531653464303134386238316139323332613536613031356361356362363333643562656366
  3263306464313237650a303431376432656433653466656436633534303636326432623438636330
  37636431333863643766363761383632623631346363393465613335363836626634613938633431
  3031366231633763363061396432393636376264666632663539

haproxy_frontends:
  - name: consul
    address: "*"
    port: 8500
    ssl: true
    crts:
      - "/etc/acme/certs/wildcard.{{ server_url }}.pem"
    default_backend: consul
  - name: vault
    address: "*"
    port: 8200
    ssl: true
    crts:
      - "/etc/acme/certs/wildcard.{{ server_url }}.pem"
    default_backend: vault

haproxy_backend_default_balance: roundrobin
haproxy_backends:
  - name: consul
    httpcheck: true
    balance: roundrobin
    servers:
      - name: consul-01.redstone
        address: consul-01.redstone
        port: 8500
      - name: consul-02.redstone
        address: consul-02.redstone
        port: 8500
      - name: consul-03.redstone
        address: consul-03.redstone
        port: 8500
    port: 8500
    options:
      - check
  - name: vault
    balance: first
    http_check:
      send:
        method: GET
        uri: /v1/sys/health?standbyok=true
      expect: status 200
    port: 8200
    options:
      - check
    servers:
      - name: vault-01.redstone
        address: vault-01.redstone
        port: 8200
      - name: vault-02.redstone
        address: vault-02.redstone
        port: 8200
      - name: vault-03.redstone
        address: vault-03.redstone
        port: 8200
